name: Final Exam 2024 - Example Rubric

rules:
  - type: CONDITIONAL
    if_rules:
      - type: EXACT_MATCH
        question_id: Q1
        answer: "A"
        max_points: 0
        config:
          ignore_case: true
    then_rules:
      - type: EXACT_MATCH
        question_id: Q2
        answer: "B"
        max_points: 5.0
        config:
          ignore_case: true
    if_mode: and
    description: "If Q1 answer is A, then Q2 should be B (dependent calculation)"

  - type: CONDITIONAL
    if_rules:
      - type: EXACT_MATCH
        question_id: Q1
        answer: "C"
        max_points: 0
        config:
          ignore_case: true
    then_rules:
      - type: EXACT_MATCH
        question_id: Q2
        answer: "D"
        max_points: 5.0
        config:
          ignore_case: true
    if_mode: and
    description: "If Q1 answer is C, then Q2 should be D (alternative calculation)"

  - type: ASSUMPTION_SET
    assumptions:
      - name: "Interpretation A - Classical Mechanics"
        rules:
          - type: EXACT_MATCH
            question_id: Q3
            answer: "kinetic"
            max_points: 3.0
            config:
              ignore_case: true
          - type: EXACT_MATCH
            question_id: Q4
            answer: "increases"
            max_points: 3.0
            config:
              ignore_case: true
          - type: EXACT_MATCH
            question_id: Q5
            answer: "parabolic"
            max_points: 4.0
            config:
              ignore_case: true
      - name: "Interpretation B - Quantum Mechanics"
        rules:
          - type: EXACT_MATCH
            question_id: Q3
            answer: "potential"
            max_points: 3.0
            config:
              ignore_case: true
          - type: EXACT_MATCH
            question_id: Q4
            answer: "quantized"
            max_points: 3.0
            config:
              ignore_case: true
          - type: EXACT_MATCH
            question_id: Q5
            answer: "discrete"
            max_points: 4.0
            config:
              ignore_case: true
    mode: best
    description: "Physics problem with two valid interpretations"

  - type: PROGRAMMABLE
    question_id: Q6
    code: |
      # Grade essay based on keywords
      required_keywords = ['algorithm', 'complexity', 'optimization']
      optional_keywords = ['dynamic programming', 'greedy', 'divide and conquer']

      answer_lower = answer.lower()
      points_awarded = 0.0
      feedback_parts = []

      # Check required keywords (2 points each)
      for keyword in required_keywords:
          if keyword in answer_lower:
              points_awarded += 2.0
              feedback_parts.append(f'Found "{keyword}"')
          else:
              feedback_parts.append(f'Missing "{keyword}"')

      # Check optional keywords (1 point each, max 2)
      optional_found = 0
      for keyword in optional_keywords:
          if keyword in answer_lower and optional_found < 2:
              points_awarded += 1.0
              optional_found += 1
              feedback_parts.append(f'Bonus for "{keyword}"')

      # Provide feedback
      feedback = '; '.join(feedback_parts)
      if points_awarded >= 8.0:
          feedback += ' - Excellent answer!'
      elif points_awarded >= 6.0:
          feedback += ' - Good answer'
      else:
          feedback += ' - Needs improvement'
    max_points: 8.0
    description: "Essay question about algorithms (keyword-based grading)"

  - type: PROGRAMMABLE
    question_id: Q7
    code: |
      try:
          student_value = float(answer.strip())
          correct_value = 42.5
          tolerance = 0.5
          
          if abs(student_value - correct_value) <= tolerance:
              points_awarded = 5.0
              feedback = f'Correct! ({student_value} is within tolerance of {correct_value})'
          else:
              diff = abs(student_value - correct_value)
              if diff <= 2.0:
                  points_awarded = 3.0
                  feedback = f'Close! Off by {diff:.2f}'
              else:
                  points_awarded = 0.0
                  feedback = f'Incorrect. Expected ~{correct_value}, got {student_value}'
      except ValueError:
          points_awarded = 0.0
          feedback = 'Invalid number format'
    max_points: 5.0
    description: "Numerical answer with tolerance (Q7)"

  - type: KEYWORD
    question_id: Q8
    keywords:
      - mitochondria
      - energy
      - ATP
      - cellular respiration
      - powerhouse
      - glucose
    mode: partial
    max_points: 10.0
    config:
      ignore_case: true
    description: "Biology question about cell organelles"

  - type: REGEX
    question_id: Q9
    pattern: '^\\b[A-Z]{2,}\\b|\\d{4}|http[s]?://\\S+$'
    max_points: 5.0
    config:
      ignore_case: false
      multi_line: false
      dotall: false
    description: "Check for acronyms, year, or URL"

metadata:
  course: CS 101
  semester: Spring 2024
  total_points: 42.0
